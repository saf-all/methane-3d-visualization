<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Methane Molecule 3D Model</title>
    <style>
        body { margin: 0; overflow: hidden; background-color: #000; }
        canvas { display: block; }
    </style>
</head>
<body>

<script type="importmap">
    {
        "imports": {
            "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
            "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
        }
    }
</script>

<script type="module">
    import * as THREE from 'three';
    import { OrbitControls } from 'three/addons/controls/OrbitControls.js';

    // ------------------------------------------------------------------
    // 1. SCENE & RENDERER SETUP
    // ------------------------------------------------------------------
    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
    camera.position.set(0, 5, 10);

    const renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.shadowMap.enabled = true; // Enable shadows
    document.body.appendChild(renderer.domElement);

    // ------------------------------------------------------------------
    // 2. LIGHTING
    // ------------------------------------------------------------------
    // Ambient light for general visibility
    const ambientLight = new THREE.AmbientLight(0xffffff, 0.4);
    scene.add(ambientLight);

    // Directional light to create sharp shadows on the green plane
    const dirLight = new THREE.DirectionalLight(0xffffff, 1.5);
    dirLight.position.set(5, 10, 5);
    dirLight.castShadow = true;
    // Improve shadow quality
    dirLight.shadow.mapSize.width = 1024;
    dirLight.shadow.mapSize.height = 1024;
    scene.add(dirLight);

    // ------------------------------------------------------------------
    // 3. THE PLANE (Ground)
    // ------------------------------------------------------------------
    const planeGeometry = new THREE.CircleGeometry(20, 64);
    const planeMaterial = new THREE.MeshStandardMaterial({ 
        color: 0x228B22, // Forest Green
        roughness: 0.8 
    });
    const plane = new THREE.Mesh(planeGeometry, planeMaterial);
    plane.rotation.x = -Math.PI / 2; // Lay flat
    plane.position.y = -4; // Position below the molecule
    plane.receiveShadow = true; // Allow shadows to be cast on it
    scene.add(plane);

    // ------------------------------------------------------------------
    // 4. THE MOLECULE GROUP (Container for animation)
    // ------------------------------------------------------------------
    const molecule = new THREE.Group();
    scene.add(molecule);

    // Define Materials
    const carbonMat = new THREE.MeshStandardMaterial({ color: 0xff0000 }); // Red
    const hydrogenMat = new THREE.MeshStandardMaterial({ color: 0x0000ff }); // Blue
    const bondMat = new THREE.MeshStandardMaterial({ 
        color: 0xffffff, // White base
        emissive: 0x333333 // Light gray emissive as requested
    });

    // Create Carbon (Center)
    const carbon = new THREE.Mesh(new THREE.SphereGeometry(1, 32, 32), carbonMat);
    carbon.castShadow = true;
    molecule.add(carbon);

    // Tetrahedral coordinates for Hydrogen atoms
    // In a tetrahedron, angles are approx 109.5 degrees
    const hPositions = [
        new THREE.Vector3(0, 2.5, 0),
        new THREE.Vector3(2.35, -0.83, 0),
        new THREE.Vector3(-1.17, -0.83, 2.03),
        new THREE.Vector3(-1.17, -0.83, -2.03)
    ];

    hPositions.forEach((pos) => {
        // Create Hydrogen Sphere
        const hydrogen = new THREE.Mesh(new THREE.SphereGeometry(0.6, 32, 32), hydrogenMat);
        hydrogen.position.copy(pos);
        hydrogen.castShadow = true;
        molecule.add(hydrogen);

        // Create Bond (Cylinder)
        const distance = pos.length();
        const cylinderGeo = new THREE.CylinderGeometry(0.15, 0.15, distance, 16);
        const bond = new THREE.Mesh(cylinderGeo, bondMat);

        // Position bond halfway between C and H
        bond.position.copy(pos).multiplyScalar(0.5);

        // Orient the cylinder to point from center to Hydrogen
        bond.quaternion.setFromUnitVectors(new THREE.Vector3(0, 1, 0), pos.clone().normalize());
        
        bond.castShadow = true;
        molecule.add(bond);
    });

    // ------------------------------------------------------------------
    // 5. CONTROLS & ANIMATION
    // ------------------------------------------------------------------
    const controls = new OrbitControls(camera, renderer.domElement);
    controls.enableDamping = true;

    function animate() {
        requestAnimationFrame(animate);

        // Rotation logic: Only the molecule rotates, not the plane
        molecule.rotation.y += 0.01;
        molecule.rotation.x += 0.005;

        controls.update();
        renderer.render(scene, camera);
    }

    // Handle Window Resize
    window.addEventListener('resize', () => {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
    });

    animate();
</script>
</body>
</html>